# å¦‚æ„è®¢å•ç³»ç»Ÿæ¨¡å—æ±‡æ€»è¯´æ˜

## 1. æ¨¡å—æ¦‚è§ˆ

å¦‚æ„è®¢å•ç³»ç»Ÿé‡‡ç”¨å¾®æœåŠ¡æ¶æ„ï¼Œå…±åŒ…å«12ä¸ªæ ¸å¿ƒæœåŠ¡æ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—è´Ÿè´£ç‰¹å®šçš„ä¸šåŠ¡é¢†åŸŸï¼Œé€šè¿‡Dubboè¿›è¡ŒæœåŠ¡æ²»ç†å’Œé€šä¿¡ã€‚

### 1.1 æœåŠ¡æ¨¡å—æ¸…å•

| åºå· | æœåŠ¡æ¨¡å— | ä¸»è¦èŒè´£ | æ–‡æ¡£çŠ¶æ€ | æŠ€æœ¯ç‰¹ç‚¹ |
|------|----------|----------|----------|----------|
| 1 | è®¢å•æœåŠ¡ | è®¢å•ç”Ÿå‘½å‘¨æœŸç®¡ç† | âœ… å·²å®Œæˆ | åˆ†å¸ƒå¼äº‹åŠ¡ã€çŠ¶æ€æœºã€åˆ†å¸ƒå¼é” |
| 2 | å±¥çº¦æœåŠ¡ | è®¢å•å±¥çº¦æµç¨‹ç¼–æ’ | âœ… å·²å®Œæˆ | Sagaäº‹åŠ¡ã€çŠ¶æ€æœºç¼–æ’ã€è¡¥å¿æœºåˆ¶ |
| 3 | åº“å­˜æœåŠ¡ | å•†å“åº“å­˜ç®¡ç† | âœ… å·²å®Œæˆ | TCCäº‹åŠ¡ã€åŒå­˜å‚¨ã€é˜²è¶…å– |
| 4 | è¥é”€æœåŠ¡ | ä»·æ ¼è®¡ç®—å’Œä¼˜æƒ åˆ¸ | âœ… å·²å®Œæˆ | åˆ†æ‘Šç®—æ³•ã€ç­–ç•¥æ¨¡å¼ã€ç²¾ç¡®è®¡ç®— |
| 5 | æ”¯ä»˜æœåŠ¡ | æ”¯ä»˜å¤„ç† | ğŸ“ å¾…å®Œå–„ | æ”¯ä»˜ç½‘å…³ã€å¼‚æ­¥å›è°ƒã€å¹‚ç­‰å¤„ç† |
| 6 | å•†å“æœåŠ¡ | å•†å“ä¿¡æ¯ç®¡ç† | ğŸ“ å¾…å®Œå–„ | ç¼“å­˜ç­–ç•¥ã€æ•°æ®åŒæ­¥ |
| 7 | é£æ§æœåŠ¡ | é£é™©æ§åˆ¶ | ğŸ“ å¾…å®Œå–„ | è§„åˆ™å¼•æ“ã€å®æ—¶è®¡ç®— |
| 8 | åœ°å€æœåŠ¡ | åœ°å€ç®¡ç† | ğŸ“ å¾…å®Œå–„ | åœ°ç†ç¼–ç ã€åŒºåŸŸç®¡ç† |
| 9 | WMSæœåŠ¡ | ä»“å‚¨ç®¡ç† | ğŸ“ å¾…å®Œå–„ | æ‹£è´§æµç¨‹ã€åº“ä½ç®¡ç† |
| 10 | TMSæœåŠ¡ | è¿è¾“ç®¡ç† | ğŸ“ å¾…å®Œå–„ | ç‰©æµè·Ÿè¸ªã€é…é€ä¼˜åŒ– |
| 11 | å®¢æˆ·æœåŠ¡ | ç”¨æˆ·ç®¡ç† | ğŸ“ å¾…å®Œå–„ | ç”¨æˆ·ç”»åƒã€æƒé™ç®¡ç† |
| 12 | ç½‘å…³æœåŠ¡ | APIç½‘å…³ | ğŸ“ å¾…å®Œå–„ | è·¯ç”±è½¬å‘ã€é™æµç†”æ–­ |

## 2. æ ¸å¿ƒæ¨¡å—æ·±åº¦åˆ†æ

### 2.1 è®¢å•æœåŠ¡æ¨¡å— â­â­â­â­â­

**æ ¸å¿ƒä»·å€¼**ï¼šè®¢å•ç³»ç»Ÿçš„ä¸­æ¢ï¼Œè´Ÿè´£æ•´ä¸ªè®¢å•ç”Ÿå‘½å‘¨æœŸç®¡ç†

**æŠ€æœ¯äº®ç‚¹**ï¼š
- **åˆ†å¸ƒå¼äº‹åŠ¡**ï¼šä½¿ç”¨Seata ATæ¨¡å¼ä¿è¯æ•°æ®ä¸€è‡´æ€§
- **åˆ†å¸ƒå¼é”**ï¼šRedissonå¤šé”æœºåˆ¶é˜²æ­¢å¹¶å‘é—®é¢˜
- **çŠ¶æ€æœºç®¡ç†**ï¼šæ¸…æ™°çš„è®¢å•çŠ¶æ€æµè½¬æ§åˆ¶
- **æ¶ˆæ¯é©±åŠ¨**ï¼šåŸºäºRocketMQçš„å¼‚æ­¥å¤„ç†
- **å»ºé€ è€…æ¨¡å¼**ï¼šä¼˜é›…æ„å»ºå¤æ‚è®¢å•æ•°æ®

**å…³é”®ä¸šåŠ¡æµç¨‹**ï¼š
```mermaid
graph LR
    A[è®¢å•åˆ›å»º] --> B[é£æ§æ£€æŸ¥]
    B --> C[ä»·æ ¼è®¡ç®—]
    C --> D[åº“å­˜æ‰£å‡]
    D --> E[ä¼˜æƒ åˆ¸é”å®š]
    E --> F[è®¢å•å…¥åº“]
    F --> G[æ”¯ä»˜å¤„ç†]
    G --> H[å±¥çº¦è§¦å‘]
```

**æŠ€æœ¯éš¾ç‚¹**ï¼š
- åˆ†å¸ƒå¼äº‹åŠ¡ä¸€è‡´æ€§ä¿è¯
- é«˜å¹¶å‘ä¸‹çš„æ€§èƒ½ä¼˜åŒ–
- å¤æ‚ä¸šåŠ¡è§„åˆ™çš„çŠ¶æ€ç®¡ç†
- å¼‚å¸¸åœºæ™¯çš„è¡¥å¿æœºåˆ¶

### 2.2 å±¥çº¦æœåŠ¡æ¨¡å— â­â­â­â­

**æ ¸å¿ƒä»·å€¼**ï¼šåè°ƒWMSå’ŒTMSå®Œæˆè®¢å•å±¥çº¦ï¼Œç¡®ä¿è®¢å•é¡ºåˆ©äº¤ä»˜

**æŠ€æœ¯äº®ç‚¹**ï¼š
- **Sagaåˆ†å¸ƒå¼äº‹åŠ¡**ï¼šé€‚åˆé•¿æµç¨‹ä¸šåŠ¡çš„äº‹åŠ¡ç®¡ç†
- **çŠ¶æ€æœºç¼–æ’**ï¼šJSONé…ç½®åŒ–çš„ä¸šåŠ¡æµç¨‹å®šä¹‰
- **è¡¥å¿æœºåˆ¶**ï¼šå®Œå–„çš„å¼‚å¸¸å¤„ç†å’Œå›æ»šé€»è¾‘
- **äº‹ä»¶é©±åŠ¨**ï¼šåŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„å¼‚æ­¥åè°ƒ

**æ ¸å¿ƒæµç¨‹**ï¼š
```mermaid
sequenceDiagram
    participant O as è®¢å•æœåŠ¡
    participant F as å±¥çº¦æœåŠ¡
    participant W as WMSæœåŠ¡
    participant T as TMSæœåŠ¡
    
    O->>F: è§¦å‘å±¥çº¦
    F->>F: åˆ›å»ºå±¥çº¦å•
    F->>W: è§¦å‘æ‹£è´§
    W-->>F: æ‹£è´§å®Œæˆ
    F->>T: è§¦å‘å‘è´§
    T-->>F: å‘è´§å®Œæˆ
    F-->>O: å±¥çº¦å®Œæˆ
```

**è®¾è®¡ç²¾ç²¹**ï¼š
- å»ºé€ è€…æ¨¡å¼æ„å»ºå±¥çº¦æ•°æ®
- ç­–ç•¥æ¨¡å¼å¤„ç†ä¸åŒç‰©æµäº‹ä»¶
- åˆ†å¸ƒå¼é”ä¿è¯å¹‚ç­‰æ€§
- Sagaæ¨¡å¼çš„è¡¥å¿æœºåˆ¶

### 2.3 åº“å­˜æœåŠ¡æ¨¡å— â­â­â­â­â­

**æ ¸å¿ƒä»·å€¼**ï¼šç²¾ç¡®çš„åº“å­˜ç®¡ç†ï¼Œé˜²æ­¢è¶…å–ï¼Œä¿è¯åº“å­˜æ•°æ®ä¸€è‡´æ€§

**æŠ€æœ¯äº®ç‚¹**ï¼š
- **TCCåˆ†å¸ƒå¼äº‹åŠ¡**ï¼šMySQLå’ŒRedisçš„å¼ºä¸€è‡´æ€§ä¿è¯
- **åŒå­˜å‚¨æ¶æ„**ï¼šå…¼é¡¾æ€§èƒ½å’Œå¯é æ€§
- **é˜²è¶…å–æœºåˆ¶**ï¼šåˆ†å¸ƒå¼é”+ä¹è§‚é”+åŸå­æ“ä½œ
- **å¹‚ç­‰è®¾è®¡**ï¼šå¤šå±‚æ¬¡çš„å¹‚ç­‰æ€§ä¿è¯

**æ ¸å¿ƒç®—æ³•**ï¼š
```java
// TCC Tryé˜¶æ®µï¼šæ‰£å‡é”€å”®åº“å­˜
UPDATE product_stock 
SET sale_stock_quantity = sale_stock_quantity - #{saleQuantity}
WHERE sku_code = #{skuCode} 
AND sale_stock_quantity >= #{saleQuantity}

// TCC Commité˜¶æ®µï¼šå¢åŠ å·²é”€å”®åº“å­˜
UPDATE product_stock 
SET saled_stock_quantity = saled_stock_quantity + #{saleQuantity}
WHERE sku_code = #{skuCode}
```

**æŠ€æœ¯éš¾ç‚¹**ï¼š
- é«˜å¹¶å‘ä¸‹çš„è¶…å–é˜²æŠ¤
- MySQLå’ŒRedisæ•°æ®ä¸€è‡´æ€§
- TCCäº‹åŠ¡çš„ç©ºå›æ»šå’Œæ‚¬æŒ‚é—®é¢˜
- ç¼“å­˜ç©¿é€å’Œé›ªå´©é˜²æŠ¤

### 2.4 è¥é”€æœåŠ¡æ¨¡å— â­â­â­â­

**æ ¸å¿ƒä»·å€¼**ï¼šç²¾ç¡®çš„ä»·æ ¼è®¡ç®—å’Œä¼˜æƒ åˆ¸ç®¡ç†ï¼Œç¡®ä¿è¥é”€æ´»åŠ¨çš„å‡†ç¡®æ‰§è¡Œ

**æŠ€æœ¯äº®ç‚¹**ï¼š
- **ç²¾ç¡®åˆ†æ‘Šç®—æ³•**ï¼šæ•°å­¦å‡†ç¡®çš„ä¼˜æƒ åˆ¸åˆ†æ‘Šæœºåˆ¶
- **ç­–ç•¥æ¨¡å¼**ï¼šæ”¯æŒå¤šç§ä¼˜æƒ ç­–ç•¥çš„çµæ´»æ‰©å±•
- **å¤šç»´è¿è´¹è®¡ç®—**ï¼šæ”¯æŒæŒ‰ä»¶æ•°ã€é‡é‡ã€ä½“ç§¯è®¡è´¹
- **å¹¶å‘å®‰å…¨**ï¼šä¼˜æƒ åˆ¸ä½¿ç”¨çš„åŸå­æ€§ä¿è¯

**åˆ†æ‘Šç®—æ³•**ï¼š
```
å•†å“åˆ†æ‘Šä¼˜æƒ é‡‘é¢ = ä¼˜æƒ åˆ¸æ€»é¢ Ã— (å•†å“é‡‘é¢ / è®¢å•æ€»é‡‘é¢)
æœ€åå•†å“æ‰¿æ‹…åˆ†æ‘Šè¯¯å·® = ä¼˜æƒ åˆ¸æ€»é¢ - å‰é¢æ‰€æœ‰å•†å“åˆ†æ‘Šæ€»é¢
```

**ç®—æ³•ç‰¹ç‚¹**ï¼š
- O(n)æ—¶é—´å¤æ‚åº¦ï¼Œæ€§èƒ½ä¼˜ç§€
- å‘ä¸Šå–æ•´+è¯¯å·®è°ƒæ•´ï¼Œç¡®ä¿åˆ†æ‘Šå‡†ç¡®
- æ”¯æŒä»»æ„æ•°é‡å•†å“çš„åˆ†æ‘Šè®¡ç®—

## 3. æœåŠ¡é—´åä½œæ¨¡å¼

### 3.1 æœåŠ¡è°ƒç”¨å…³ç³»å›¾

```mermaid
graph TB
    subgraph "å‰ç«¯å±‚"
        Gateway[APIç½‘å…³]
    end
    
    subgraph "æ ¸å¿ƒä¸šåŠ¡å±‚"
        Order[è®¢å•æœåŠ¡]
        Fulfill[å±¥çº¦æœåŠ¡]
        Inventory[åº“å­˜æœåŠ¡]
        Market[è¥é”€æœåŠ¡]
        Pay[æ”¯ä»˜æœåŠ¡]
    end
    
    subgraph "åŸºç¡€æœåŠ¡å±‚"
        Product[å•†å“æœåŠ¡]
        Customer[å®¢æˆ·æœåŠ¡]
        Risk[é£æ§æœåŠ¡]
        Address[åœ°å€æœåŠ¡]
    end
    
    subgraph "ç‰©æµå±‚"
        WMS[WMSæœåŠ¡]
        TMS[TMSæœåŠ¡]
    end
    
    Gateway --> Order
    Order --> Market
    Order --> Inventory
    Order --> Risk
    Order --> Product
    Order --> Address
    Order --> Pay
    Order --> Fulfill
    Fulfill --> WMS
    Fulfill --> TMS
```

### 3.2 æ•°æ®æµè½¬æ¨¡å¼

#### 3.2.1 è®¢å•åˆ›å»ºæ•°æ®æµ
```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant O as è®¢å•æœåŠ¡
    participant R as é£æ§æœåŠ¡
    participant P as å•†å“æœåŠ¡
    participant M as è¥é”€æœåŠ¡
    participant I as åº“å­˜æœåŠ¡
    
    U->>O: æäº¤è®¢å•
    O->>R: é£æ§æ£€æŸ¥
    R-->>O: æ£€æŸ¥é€šè¿‡
    O->>P: è·å–å•†å“ä¿¡æ¯
    P-->>O: å•†å“è¯¦æƒ…
    O->>M: è®¡ç®—è®¢å•ä»·æ ¼
    M-->>O: ä»·æ ¼æ˜ç»†
    O->>I: æ‰£å‡åº“å­˜
    I-->>O: æ‰£å‡æˆåŠŸ
    O-->>U: è®¢å•åˆ›å»ºæˆåŠŸ
```

#### 3.2.2 è®¢å•å±¥çº¦æ•°æ®æµ
```mermaid
sequenceDiagram
    participant O as è®¢å•æœåŠ¡
    participant F as å±¥çº¦æœåŠ¡
    participant W as WMSæœåŠ¡
    participant T as TMSæœåŠ¡
    
    O->>F: è§¦å‘å±¥çº¦(æ¶ˆæ¯)
    F->>F: åˆ›å»ºå±¥çº¦å•
    F->>W: WMSæ‹£è´§(Saga)
    W-->>F: æ‹£è´§å®Œæˆ
    F->>T: TMSå‘è´§(Saga)
    T-->>F: å‘è´§å®Œæˆ
    F->>O: æ›´æ–°è®¢å•çŠ¶æ€(æ¶ˆæ¯)
```

## 4. æŠ€æœ¯æ¶æ„åˆ†æ

### 4.1 åˆ†å¸ƒå¼äº‹åŠ¡ç­–ç•¥

| åœºæ™¯ | äº‹åŠ¡æ¨¡å¼ | é€‚ç”¨æœåŠ¡ | ç‰¹ç‚¹ |
|------|----------|----------|------|
| çŸ­äº‹åŠ¡ | ATæ¨¡å¼ | è®¢å•æœåŠ¡ | ç®€å•æ˜“ç”¨ï¼Œæ€§èƒ½å¥½ |
| é•¿äº‹åŠ¡ | Sagaæ¨¡å¼ | å±¥çº¦æœåŠ¡ | é€‚åˆé•¿æµç¨‹ï¼Œè¡¥å¿æœºåˆ¶å®Œå–„ |
| å¼ºä¸€è‡´æ€§ | TCCæ¨¡å¼ | åº“å­˜æœåŠ¡ | å¼ºä¸€è‡´æ€§ï¼Œæ€§èƒ½è¾ƒå¥½ |
| æœ€ç»ˆä¸€è‡´æ€§ | äº‹åŠ¡æ¶ˆæ¯ | è·¨æœåŠ¡é€šä¿¡ | å¼‚æ­¥å¤„ç†ï¼Œé«˜æ€§èƒ½ |

### 4.2 ç¼“å­˜ç­–ç•¥è®¾è®¡

#### 4.2.1 å¤šçº§ç¼“å­˜æ¶æ„
```mermaid
graph TB
    subgraph "åº”ç”¨å±‚"
        A[æœ¬åœ°ç¼“å­˜-Caffeine]
    end
    
    subgraph "åˆ†å¸ƒå¼ç¼“å­˜å±‚"
        B[Redisé›†ç¾¤]
    end
    
    subgraph "æ•°æ®åº“å±‚"
        C[MySQLä¸»ä»]
    end
    
    A --> B
    B --> C
```

#### 4.2.2 ç¼“å­˜åº”ç”¨åœºæ™¯
- **å•†å“ä¿¡æ¯ç¼“å­˜**ï¼šçƒ­ç‚¹å•†å“æ•°æ®ï¼ŒTTL=1å°æ—¶
- **åº“å­˜æ•°æ®ç¼“å­˜**ï¼šå®æ—¶åº“å­˜ä¿¡æ¯ï¼ŒTTL=10åˆ†é’Ÿ
- **ç”¨æˆ·ä¿¡æ¯ç¼“å­˜**ï¼šç”¨æˆ·åŸºç¡€ä¿¡æ¯ï¼ŒTTL=30åˆ†é’Ÿ
- **ä¼˜æƒ åˆ¸ç¼“å­˜**ï¼šæ´»åŠ¨ä¼˜æƒ åˆ¸ä¿¡æ¯ï¼ŒTTL=1å°æ—¶

### 4.3 æ¶ˆæ¯é˜Ÿåˆ—æ¶æ„

#### 4.3.1 æ¶ˆæ¯ç±»å‹åˆ†ç±»
```mermaid
graph LR
    subgraph "åŒæ­¥æ¶ˆæ¯"
        A[è®¢å•æ”¯ä»˜]
        B[åº“å­˜æ‰£å‡]
    end
    
    subgraph "å¼‚æ­¥æ¶ˆæ¯"
        C[è®¢å•å±¥çº¦]
        D[çŠ¶æ€é€šçŸ¥]
    end
    
    subgraph "å»¶æ—¶æ¶ˆæ¯"
        E[æ”¯ä»˜è¶…æ—¶]
        F[è®¢å•å–æ¶ˆ]
    end
    
    subgraph "äº‹åŠ¡æ¶ˆæ¯"
        G[å±¥çº¦è§¦å‘]
        H[çŠ¶æ€æ›´æ–°]
    end
```

#### 4.3.2 æ¶ˆæ¯ä¸»é¢˜è®¾è®¡
| ä¸»é¢˜åç§° | æ¶ˆæ¯ç±»å‹ | ç”Ÿäº§è€… | æ¶ˆè´¹è€… | ç”¨é€” |
|----------|----------|--------|--------|------|
| order-paid-success | æ™®é€šæ¶ˆæ¯ | æ”¯ä»˜æœåŠ¡ | å±¥çº¦æœåŠ¡ | æ”¯ä»˜æˆåŠŸé€šçŸ¥ |
| order-fulfill-trigger | äº‹åŠ¡æ¶ˆæ¯ | è®¢å•æœåŠ¡ | å±¥çº¦æœåŠ¡ | å±¥çº¦è§¦å‘ |
| order-status-change | æ™®é€šæ¶ˆæ¯ | è®¢å•æœåŠ¡ | é€šçŸ¥æœåŠ¡ | çŠ¶æ€å˜æ›´é€šçŸ¥ |
| order-timeout-cancel | å»¶æ—¶æ¶ˆæ¯ | è®¢å•æœåŠ¡ | è®¢å•æœåŠ¡ | æ”¯ä»˜è¶…æ—¶å–æ¶ˆ |

## 5. æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 5.1 æ•°æ®åº“ä¼˜åŒ–

#### 5.1.1 ç´¢å¼•ä¼˜åŒ–
```sql
-- è®¢å•è¡¨æ ¸å¿ƒç´¢å¼•
CREATE INDEX idx_order_user_status ON order_info(user_id, order_status, gmt_create);
CREATE INDEX idx_order_status_time ON order_info(order_status, gmt_create);

-- åº“å­˜è¡¨æ ¸å¿ƒç´¢å¼•  
CREATE UNIQUE INDEX uk_product_stock_sku ON product_stock(sku_code);
CREATE INDEX idx_stock_quantity ON product_stock(sale_stock_quantity);

-- ä¼˜æƒ åˆ¸è¡¨æ ¸å¿ƒç´¢å¼•
CREATE INDEX idx_coupon_user_status ON coupon(user_id, used, gmt_create);
```

#### 5.1.2 åˆ†è¡¨åˆ†åº“ç­–ç•¥
- **è®¢å•è¡¨**ï¼šæŒ‰ç”¨æˆ·IDå“ˆå¸Œåˆ†è¡¨ï¼Œå•è¡¨500ä¸‡æ•°æ®
- **è®¢å•æ¡ç›®è¡¨**ï¼šæŒ‰è®¢å•IDåˆ†è¡¨ï¼Œä¸è®¢å•è¡¨ä¿æŒä¸€è‡´
- **åº“å­˜æ—¥å¿—è¡¨**ï¼šæŒ‰æ—¶é—´åˆ†è¡¨ï¼Œæœˆè¡¨å­˜å‚¨
- **æ”¯ä»˜è®°å½•è¡¨**ï¼šæŒ‰æ”¯ä»˜æ—¶é—´åˆ†è¡¨ï¼Œä¾¿äºå¯¹è´¦

### 5.2 ç¼“å­˜ä¼˜åŒ–

#### 5.2.1 ç¼“å­˜é¢„çƒ­ç­–ç•¥
```java
@Component
public class CacheWarmupService {
    
    @PostConstruct
    public void warmupCache() {
        // é¢„çƒ­çƒ­ç‚¹å•†å“ç¼“å­˜
        warmupHotProducts();
        
        // é¢„çƒ­æ´»è·ƒç”¨æˆ·ç¼“å­˜
        warmupActiveUsers();
        
        // é¢„çƒ­ä¼˜æƒ åˆ¸é…ç½®ç¼“å­˜
        warmupCouponConfigs();
    }
}
```

#### 5.2.2 ç¼“å­˜æ›´æ–°ç­–ç•¥
- **ä¸»åŠ¨æ›´æ–°**ï¼šæ•°æ®å˜æ›´æ—¶ä¸»åŠ¨åˆ é™¤ç›¸å…³ç¼“å­˜
- **è¢«åŠ¨æ›´æ–°**ï¼šç¼“å­˜è¿‡æœŸæ—¶é‡æ–°åŠ è½½
- **å¼‚æ­¥æ›´æ–°**ï¼šé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å¼‚æ­¥æ›´æ–°ç¼“å­˜

### 5.3 æœåŠ¡è°ƒç”¨ä¼˜åŒ–

#### 5.3.1 æ‰¹é‡è°ƒç”¨
```java
// æ‰¹é‡è·å–å•†å“ä¿¡æ¯ï¼Œå‡å°‘ç½‘ç»œè°ƒç”¨
List<ProductSkuDTO> productSkus = productApi.batchGetProductSkus(skuCodes);

// æ‰¹é‡æ‰£å‡åº“å­˜ï¼Œæé«˜æ€§èƒ½
Boolean result = inventoryApi.batchDeductStock(deductRequests);
```

#### 5.3.2 å¼‚æ­¥è°ƒç”¨
```java
// å¼‚æ­¥å‘é€é€šçŸ¥ï¼Œä¸é˜»å¡ä¸»æµç¨‹
CompletableFuture.runAsync(() -> {
    notificationService.sendOrderNotification(orderId);
});
```

## 6. ç›‘æ§ä¸è¿ç»´

### 6.1 ç›‘æ§æŒ‡æ ‡ä½“ç³»

#### 6.1.1 ä¸šåŠ¡æŒ‡æ ‡
- **è®¢å•é‡æŒ‡æ ‡**ï¼šåˆ›å»ºé‡ã€æ”¯ä»˜é‡ã€å®Œæˆé‡ã€å–æ¶ˆç‡
- **åº“å­˜æŒ‡æ ‡**ï¼šæ‰£å‡æˆåŠŸç‡ã€è¶…å–æ¬¡æ•°ã€åº“å­˜å‡†ç¡®æ€§
- **è¥é”€æŒ‡æ ‡**ï¼šä¼˜æƒ åˆ¸ä½¿ç”¨ç‡ã€ä»·æ ¼è®¡ç®—å‡†ç¡®æ€§
- **å±¥çº¦æŒ‡æ ‡**ï¼šå±¥çº¦æˆåŠŸç‡ã€å¹³å‡å±¥çº¦æ—¶é•¿

#### 6.1.2 æŠ€æœ¯æŒ‡æ ‡
- **æœåŠ¡æŒ‡æ ‡**ï¼šQPSã€RTã€é”™è¯¯ç‡ã€å¯ç”¨æ€§
- **æ•°æ®åº“æŒ‡æ ‡**ï¼šè¿æ¥æ•°ã€æ…¢æŸ¥è¯¢ã€é”ç­‰å¾…
- **ç¼“å­˜æŒ‡æ ‡**ï¼šå‘½ä¸­ç‡ã€è¿‡æœŸç‡ã€å†…å­˜ä½¿ç”¨ç‡
- **æ¶ˆæ¯é˜Ÿåˆ—æŒ‡æ ‡**ï¼šç”Ÿäº§é€Ÿç‡ã€æ¶ˆè´¹é€Ÿç‡ã€ç§¯å‹é‡

### 6.2 å‘Šè­¦æœºåˆ¶

#### 6.2.1 å‘Šè­¦è§„åˆ™
```yaml
alerts:
  - name: è®¢å•åˆ›å»ºå¤±è´¥ç‡è¿‡é«˜
    condition: order.create.failure.rate > 0.05
    duration: 5m
    severity: critical
    
  - name: åº“å­˜æ‰£å‡å¤±è´¥
    condition: inventory.deduct.failure.rate > 0.01
    duration: 2m
    severity: warning
    
  - name: æ”¯ä»˜å›è°ƒå»¶è¿Ÿ
    condition: payment.callback.delay > 30s
    duration: 1m
    severity: warning
```

## 7. ç³»ç»Ÿæ‰©å±•æ€§åˆ†æ

### 7.1 æ°´å¹³æ‰©å±•èƒ½åŠ›

#### 7.1.1 æ— çŠ¶æ€æœåŠ¡
æ‰€æœ‰ä¸šåŠ¡æœåŠ¡éƒ½è®¾è®¡ä¸ºæ— çŠ¶æ€ï¼Œæ”¯æŒæ°´å¹³æ‰©å±•ï¼š
- è®¢å•æœåŠ¡ï¼šå¯æ ¹æ®è´Ÿè½½åŠ¨æ€æ‰©ç¼©å®¹
- åº“å­˜æœåŠ¡ï¼šæ”¯æŒæŒ‰å•†å“ç»´åº¦åˆ†ç‰‡æ‰©å±•
- è¥é”€æœåŠ¡ï¼šæ”¯æŒæŒ‰ç”¨æˆ·ç»´åº¦åˆ†ç‰‡æ‰©å±•

#### 7.1.2 æ•°æ®åˆ†ç‰‡ç­–ç•¥
```java
// è®¢å•åˆ†ç‰‡ç­–ç•¥
public class OrderShardingStrategy implements ShardingStrategy {
    
    @Override
    public String getShardingKey(String userId) {
        return "order_" + (userId.hashCode() % 16);
    }
}
```

### 7.2 åŠŸèƒ½æ‰©å±•èƒ½åŠ›

#### 7.2.1 æ–°å¢è¥é”€ç­–ç•¥
```java
// æ–°å¢æ‹¼å›¢ä¼˜æƒ ç­–ç•¥
@Component
public class GroupBuyDiscountStrategy implements DiscountStrategy {
    
    @Override
    public Integer calculateDiscount(DiscountContext context) {
        // æ‹¼å›¢ä¼˜æƒ è®¡ç®—é€»è¾‘
        return calculateGroupBuyDiscount(context);
    }
    
    @Override
    public DiscountTypeEnum getDiscountType() {
        return DiscountTypeEnum.GROUP_BUY;
    }
}
```

#### 7.2.2 æ–°å¢æ”¯ä»˜æ–¹å¼
```java
// æ–°å¢æ•°å­—è´§å¸æ”¯ä»˜
@Component
public class CryptocurrencyPaymentHandler implements PaymentHandler {
    
    @Override
    public PaymentResult processPayment(PaymentRequest request) {
        // æ•°å­—è´§å¸æ”¯ä»˜å¤„ç†é€»è¾‘
        return processCryptocurrencyPayment(request);
    }
    
    @Override
    public PaymentTypeEnum getPaymentType() {
        return PaymentTypeEnum.CRYPTOCURRENCY;
    }
}
```

## 8. æ€»ç»“ä¸å±•æœ›

### 8.1 ç³»ç»Ÿä¼˜åŠ¿

**æ¶æ„ä¼˜åŠ¿**ï¼š
- âœ… å¾®æœåŠ¡æ¶æ„ï¼ŒæœåŠ¡èŒè´£æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•
- âœ… åˆ†å¸ƒå¼äº‹åŠ¡ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Œæ”¯æŒå¤æ‚ä¸šåŠ¡åœºæ™¯
- âœ… æ¶ˆæ¯é©±åŠ¨æ¶æ„ï¼Œå¼‚æ­¥å¤„ç†æå‡ç³»ç»Ÿæ€§èƒ½
- âœ… å¤šçº§ç¼“å­˜æ¶æ„ï¼Œæ˜¾è‘—æå‡ç³»ç»Ÿå“åº”é€Ÿåº¦

**æŠ€æœ¯ä¼˜åŠ¿**ï¼š
- âœ… æˆç†Ÿçš„æŠ€æœ¯æ ˆé€‰å‹ï¼Œç¨³å®šå¯é 
- âœ… å®Œå–„çš„ç›‘æ§å’Œå‘Šè­¦ä½“ç³»
- âœ… çµæ´»çš„æ‰©å±•æœºåˆ¶ï¼Œæ”¯æŒä¸šåŠ¡å¿«é€Ÿè¿­ä»£
- âœ… ä¸°å¯Œçš„è®¾è®¡æ¨¡å¼åº”ç”¨ï¼Œä»£ç è´¨é‡é«˜

**ä¸šåŠ¡ä¼˜åŠ¿**ï¼š
- âœ… æ”¯æŒå¤æ‚çš„ç”µå•†ä¸šåŠ¡åœºæ™¯
- âœ… ç²¾ç¡®çš„ä»·æ ¼è®¡ç®—å’Œåº“å­˜ç®¡ç†
- âœ… å®Œæ•´çš„è®¢å•ç”Ÿå‘½å‘¨æœŸç®¡ç†
- âœ… çµæ´»çš„è¥é”€ç­–ç•¥æ”¯æŒ

### 8.2 æŒç»­æ”¹è¿›æ–¹å‘

**æŠ€æœ¯æ”¹è¿›**ï¼š
- ğŸ”„ å¼•å…¥æ›´å…ˆè¿›çš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ
- ğŸ”„ ä¼˜åŒ–ç¼“å­˜ç­–ç•¥ï¼Œæå‡ç¼“å­˜å‘½ä¸­ç‡
- ğŸ”„ å®Œå–„æœåŠ¡æ²»ç†ï¼Œå¢å¼ºç³»ç»Ÿç¨³å®šæ€§
- ğŸ”„ å¼•å…¥æœºå™¨å­¦ä¹ ï¼Œä¼˜åŒ–ä¸šåŠ¡å†³ç­–

**ä¸šåŠ¡æ”¹è¿›**ï¼š
- ğŸ”„ æ”¯æŒæ›´å¤šè¥é”€ç©æ³•ï¼ˆæ‹¼å›¢ã€ç ä»·ã€ç§’æ€ï¼‰
- ğŸ”„ å¢å¼ºä¸ªæ€§åŒ–æ¨èèƒ½åŠ›
- ğŸ”„ ä¼˜åŒ–ç‰©æµé…é€ç®—æ³•
- ğŸ”„ å®Œå–„é£æ§è§„åˆ™å¼•æ“

å¦‚æ„è®¢å•ç³»ç»Ÿé€šè¿‡ç²¾å¿ƒè®¾è®¡çš„å¾®æœåŠ¡æ¶æ„å’Œå…ˆè¿›çš„æŠ€æœ¯æ–¹æ¡ˆï¼Œæ„å»ºäº†ä¸€ä¸ªé«˜æ€§èƒ½ã€é«˜å¯ç”¨ã€æ˜“æ‰©å±•çš„ç”µå•†è®¢å•å¤„ç†å¹³å°ï¼Œä¸ºä¸šåŠ¡å‘å±•æä¾›äº†åšå®çš„æŠ€æœ¯åŸºç¡€ã€‚
